<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webcam Capture</title>
    <style>
      #video-container {
        position: relative;
        width: 640px;
        height: 480px;
        margin: 0 auto;
      }
      #video {
        width: 100%;
        height: 100%;
      }
      #capture-btn {
        display: block;
        margin: 20px auto;
        padding: 10px 20px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div id="video-container">
      <video id="video" autoplay></video>
    </div>
    <div
      id="message"
      style="text-align: center; font-size: 20px; font-weight: bold"
    >
      <button id="capture-btn">Capture Photo</button>
    </div>

    <script>
      const video = document.getElementById("video");
      const captureBtn = document.getElementById("capture-btn");

      // Accéder à la flux vidéo de la webcam
      navigator.mediaDevices
        .getUserMedia({ video: true })
        .then((stream) => {
          video.srcObject = stream;
        })
        .catch((error) => {
          console.error("Error accessing webcam:", error);
        });

      // Capturer une photo lorsque le bouton est cliqué
      captureBtn.addEventListener("click", () => {
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const photoDataUrl = canvas.toDataURL("image/jpeg");

        // Envoyer la photo capturée au serveur (à implémenter)
        sendPhoto(photoDataUrl);
      });

      // Fonction pour envoyer la photo capturée au serveur (à implémenter)
      function sendPhoto(photoDataUrl) {
        // Convertir les données de l'image en un objet FormData
        const formData = new FormData();
        formData.append("photo", photoDataUrl);

        // Effectuer une requête POST au serveur
        fetch("/process_image", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            // Gérer la réponse du serveur
            console.log("Réponse du serveur:", data);
            if (data.success) {
              // Si la réponse est un succès, afficher le message
              const messageContainer = document.getElementById("message");
              const successMessage = document.createElement("div");
              successMessage.innerText = "Photo traitée avec succès !";
              messageContainer.appendChild(successMessage);
            } else {
              // Si la réponse indique un échec, afficher le message reçu
              const messageContainer = document.getElementById("message");
              const errorMessage = document.createElement("div");

              errorMessage.innerText = data.message;
              console.log(errorMessage)
              messageContainer.appendChild(errorMessage);
            }
          })
          .catch((error) => {
            console.error(
              "Erreur lors de l'envoi de la photo au serveur:",
              error
            );
          });
      }
    </script>
  </body>
</html>
